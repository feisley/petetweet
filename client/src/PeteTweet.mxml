<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" xmlns:ns1="com.petetweet.client.components.*"
	creationComplete="init();">
	<mx:Script>
		<![CDATA[
			import com.petetweet.client.events.*;
			import mx.rpc.events.FaultEvent;
			public var gw:NetConnection = new NetConnection();
			
			public function init():void{
				gw.connect("http://www.petetweet.com/api");
				
				loginForm.addEventListener("LoginEvent",loginHandler);
				loginForm.addEventListener("RegisterEvent",registerHandler);
			}
			//--------------------LOGIN FUNCTIONS----------------------------------
			public function loginHandler(event:LoginEvent):void{
				processLogin(event.username, event.password);
				trace("Got login: "+event.username);
			}
			public function processLogin(username:String,password:String):void{
				//TODO: error check username and password
							
				gw.call("petetweet.login", new Responder(loginPass, loginFail),username,password);
			}
			public function loginPass(userid:int):void{
				viewstack1.selectedIndex = 1;
			}
			public function loginFail(o:Object):void{
				loginForm.dispatchEvent(new LoginFailEvent());
			}
			//-----------------END LOGIN FUCTIONS-----------------------------------
			
			//-----------------REGISTER FUNCTIONS-----------------------------------
			public function registerHandler(event:RegisterEvent):void{
				processRegister(event.username, event.password, event.cpassword, event.firstname,event.lastname, event.email);
				trace("Got login: "+event.username);
			}
			public function processRegister(username:String,password:String,cpassword:String,
											firstname:String,lastname:String,email:String):void{
				//TODO: error check: all fields complete, passwords and cpassword match
							
				gw.call("petetweet.register", new Responder(registerPass, registerFail),username,password,firstname,lastname,email);
			}
			public function registerPass():void{
							
			}
			public function registerFail():void{
							
			}
			//-----------------END REGISTER FUNCTIONS-------------------------------
			
			public function getData():void {
				gw.connect("http://www.petetweet.com/api");
				gw.call("api.version", new Responder(gotData, gotError));
			}
			
			public function gotData(s:String):void {
				textArea.text = s;
			}
			
			public function gotError(o:Object):void {
				textArea.text = "The server returned an error";
			}
			
		]]>
	</mx:Script>
	<mx:ViewStack id="viewstack1" left="0" right="0" top="0" bottom="0" selectedIndex="0">
		<mx:Canvas label="login" width="100%" height="100%">
			<ns1:login_register horizontalCenter="0" verticalCenter="-6" id="loginForm">
			</ns1:login_register>
		</mx:Canvas>
		<mx:Canvas label="first" width="100%" height="100%">
			<mx:TextArea id="textArea" x="10" y="39" width="360" height="135" fontSize="18"/>
			<mx:Button x="84" y="264" label="Get Data" click="getData();" id="button1"/>
		</mx:Canvas>
		
	</mx:ViewStack>
</mx:Application>
